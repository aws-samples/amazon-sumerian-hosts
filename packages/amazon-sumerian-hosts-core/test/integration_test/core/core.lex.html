<!--
  Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.
  SPDX-License-Identifier: MIT-0
-->
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Core Host Test</title>
    <link rel="icon" href="data:;base64,iVBORw0KGgo=" />
  </head>
  <body>
    <script
      type="text/javascript"
      src="https://sdk.amazonaws.com/js/aws-sdk-2.645.0.min.js"
    ></script>
    <script type="text/javascript" src="../../../dist/host.core.js"></script>
    <script>
      function main() {
        // Initialize AWS and create Polly service objects
        window.AWS.config.region = 'us-east-1';
        window.AWS.config.credentials = new AWS.CognitoIdentityCredentials({
          IdentityPoolId: 'us-east-1:d788160e-56c8-42c1-adcd-dd271fbfc312',
        });
        const lexRuntime = new AWS.LexRuntime();

        // Add services to Host text to speech
        const {HostObject} = HOST_CORE;
        const {LexFeature} = HOST_CORE.aws;
        LexFeature.initializeService(
          lexRuntime,
          window.AWS.VERSION
        );

        // Create the speaker who will deliver speeches
        const speaker = new HostObject();

        // Add text to speech capability to the speaker
        speaker.addFeature(LexFeature, false, {
          botName: "BookTrip",
          botAlias: "Latest",
        });

        // Listen for speech events from the speaker
        speaker.listenTo(
          speaker.LexFeature.EVENTS.response,
          s => {
            console.log('lex response', s);
          },
          speaker
        );

        // Render loop
        function render() {
          speaker.update();
          requestAnimationFrame(render);
        }

        render();

        // Test speeches
        function testLex() {
          speaker.LexFeature.processWithText(
            'Book a Trip'
          );
        }

        testLex();
      }

      main();
    </script>
  </body>
</html>
